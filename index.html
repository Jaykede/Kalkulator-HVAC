<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC RTS Expert v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div class="max-w-7xl mx-auto px-4 py-8">
        <header class="mb-8 flex flex-col md:flex-row justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
            <div>
                <h1 class="text-2xl font-black text-indigo-900 tracking-tight italic">RTS <span class="text-slate-900">MASTER v7.0</span></h1>
                <p class="text-slate-500 text-sm font-semibold">Material-Based Conduction Time Series Analysis</p>
            </div>
            <div class="mt-4 md:mt-0">
                <span class="bg-slate-900 text-white px-4 py-2 rounded-full text-xs font-bold uppercase tracking-widest">Standard ASHRAE 2025</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-8 space-y-6">
                
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-xs font-black text-indigo-600 uppercase tracking-[0.2em] mb-4">I. Lingkungan & Set Point</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="p-3 bg-slate-50 rounded-xl">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">Temp Luar (°C)</label>
                            <input type="number" id="tOut" value="35" oninput="calculateRTS()" class="w-full bg-transparent font-bold text-lg outline-none">
                        </div>
                        <div class="p-3 bg-indigo-50 rounded-xl">
                            <label class="text-[10px] font-bold text-indigo-400 uppercase">Temp Dalam (°C)</label>
                            <input type="number" id="tIn" value="24" oninput="calculateRTS()" class="w-full bg-transparent font-bold text-lg outline-none">
                        </div>
                        <div class="p-3 bg-slate-50 rounded-xl">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">RH Dalam (%)</label>
                            <input type="number" id="rhIn" value="55" oninput="calculateRTS()" class="w-full bg-transparent font-bold text-lg outline-none">
                        </div>
                        <div class="p-3 bg-slate-50 rounded-xl">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">Daily Range (°C)</label>
                            <input type="number" id="dr" value="10" oninput="calculateRTS()" class="w-full bg-transparent font-bold text-lg outline-none">
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 border-l-4 border-l-indigo-600">
                    <h2 class="text-xs font-black text-indigo-600 uppercase tracking-[0.2em] mb-4">II. Struktur & Material Dinding</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase block mb-1">Jenis Material</label>
                            <select id="wallMaterial" onchange="updateMaterial()" class="w-full p-2 bg-slate-50 border rounded-lg font-bold text-sm outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="2.3" data-desc="Berat, delay panas lama">Bata Merah (Double)</option>
                                <option value="3.1" data-desc="Paling umum di Indonesia">Bata Merah (Single)</option>
                                <option value="0.65" data-desc="Isolasi panas sangat baik">Bata Ringan / Hebel</option>
                                <option value="3.5" data-desc="Cepat panas">Beton Precast 10cm</option>
                                <option value="0.4" data-desc="Khusus Cold Storage">Sandwich Panel (EPS)</option>
                            </select>
                            <p id="matDesc" class="text-[10px] text-slate-400 mt-1 italic">Paling umum di Indonesia</p>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase block mb-1">Luas Dinding (m²)</label>
                            <input type="number" id="wallArea" value="50" oninput="calculateRTS()" class="w-full p-2 bg-slate-50 border rounded-lg font-bold outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase block mb-1">U-Factor Terhitung</label>
                            <input type="number" id="uValue" value="3.1" step="0.1" readonly class="w-full p-2 bg-indigo-50 text-indigo-600 border rounded-lg font-bold outline-none">
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 border-t-4 border-t-red-500">
                    <h2 class="text-xs font-black text-red-600 uppercase tracking-[0.2em] mb-4">III. Beban Internal & Mesin</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase block mb-1">Beban Mesin (Watt)</label>
                            <input type="number" id="wattM" value="1500" oninput="calculateRTS()" class="w-full p-2 bg-slate-50 border rounded-lg font-black text-red-600 outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase block mb-1">Jumlah Orang</label>
                            <input type="number" id="ppl" value="5" oninput="calculateRTS()" class="w-full p-2 bg-slate-50 border rounded-lg font-bold outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase block mb-1">Volume Ruang (m³)</label>
                            <input type="number" id="vol" value="150" oninput="calculateRTS()" class="w-full p-2 bg-slate-50 border rounded-lg font-bold outline-none">
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-4 space-y-6">
                <div class="bg-slate-900 rounded-3xl p-8 text-white shadow-2xl sticky top-8 border-b-8 border-indigo-600">
                    <h3 class="text-indigo-400 text-[10px] font-bold uppercase tracking-[0.2em] mb-6">Hasil Analisis RTS</h3>
                    
                    <div class="space-y-1 mb-8">
                        <div class="text-5xl font-black mono tracking-tighter tabular-nums" id="resBTU">0</div>
                        <div class="text-indigo-400 font-bold text-sm tracking-widest uppercase italic">BTU / Hour</div>
                        <div class="mt-4 text-3xl font-black text-emerald-400 tabular-nums"><span id="resKW">0.00</span> <span class="text-xs">kW</span></div>
                    </div>

                    <div class="h-44 mb-8">
                        <canvas id="rtsChart"></canvas>
                    </div>

                    <div class="space-y-3 text-[11px] font-bold uppercase border-t border-slate-800 pt-6">
                        <div class="flex justify-between">
                            <span class="text-slate-500">Beban Konduksi:</span>
                            <span id="valCond" class="text-indigo-300">0 W</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-500">Beban Internal:</span>
                            <span id="valInt" class="text-red-400">0 W</span>
                        </div>
                    </div>

                    <button onclick="generatePDF()" class="w-full mt-8 bg-indigo-600 hover:bg-indigo-500 text-white font-black py-4 rounded-xl transition-all shadow-xl active:scale-95 uppercase text-xs tracking-widest">
                        Download Technical Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let rtsChart;

        // Inisialisasi material saat halaman dimuat
        function updateMaterial() {
            const select = document.getElementById('wallMaterial');
            const uValue = select.value;
            const desc = select.options[select.selectedIndex].getAttribute('data-desc');
            
            document.getElementById('uValue').value = uValue;
            document.getElementById('matDesc').innerText = desc;
            calculateRTS();
        }

        function calculateRTS() {
            // Inputs
            const tOut = parseFloat(document.getElementById('tOut').value) || 0;
            const tIn = parseFloat(document.getElementById('tIn').value) || 0;
            const uValue = parseFloat(document.getElementById('uValue').value) || 0;
            const wallArea = parseFloat(document.getElementById('wallArea').value) || 0;
            const wattM = parseFloat(document.getElementById('wattM').value) || 0;
            const ppl = parseInt(document.getElementById('ppl').value) || 0;
            const vol = parseFloat(document.getElementById('vol').value) || 0;

            // RTS Conduction Logic (Steady-State Peak)
            // RTS menggunakan Sol-Air Temperature, kita simplifikasi ke Peak Conduction
            const qCond = wallArea * uValue * (tOut - tIn);

            // Internal Logic (Radiant vs Convective split)
            const qPplSens = ppl * 75; // Sensible
            const qPplLat = ppl * 55;  // Latent
            const qInt = wattM + qPplSens + qPplLat;

            // Infiltration (Psychrometric approx)
            const qInf = (vol * 1.0 / 3.6) * 1.21 * (tOut - tIn);

            // Grand Total
            const totalWatt = qCond + qInt + qInf;
            const totalBTU = totalWatt * 3.412;

            // Update UI
            document.getElementById('resBTU').innerText = Math.round(totalBTU).toLocaleString();
            document.getElementById('resKW').innerText = (totalWatt / 1000).toFixed(2);
            document.getElementById('valCond').innerText = Math.round(qCond) + " W";
            document.getElementById('valInt').innerText = Math.round(qInt) + " W";

            updateChart(qCond, qInt, qInf);
        }

        function updateChart(cond, internal, inf) {
            const ctx = document.getElementById('rtsChart').getContext('2d');
            const data = [cond, internal, inf];

            if (rtsChart) {
                rtsChart.data.datasets[0].data = data;
                rtsChart.update();
            } else {
                rtsChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Konduksi Dinding', 'Internal/Mesin', 'Infiltrasi'],
                        datasets: [{
                            data: data,
                            backgroundColor: ['#6366f1', '#f43f5e', '#10b981'],
                            borderWidth: 0,
                            cutout: '75%'
                        }]
                    },
                    options: {
                        plugins: { legend: { display: false } },
                        maintainAspectRatio: false
                    }
                });
            }
        }

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont("helvetica", "bold");
            doc.text("TECHNICAL COOLING LOAD REPORT (RTS)", 105, 20, null, null, "center");
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text(`Material Dinding: ${document.getElementById('wallMaterial').options[document.getElementById('wallMaterial').selectedIndex].text}`, 20, 40);
            doc.text(`Kapasitas Total: ${document.getElementById('resBTU').innerText} BTU/h`, 20, 50);
            doc.text(`Power Required: ${document.getElementById('resKW').innerText} kW`, 20, 60);
            
            doc.text("---------------------------------------------------------", 20, 70);
            doc.text("Disclaimer: Hasil perhitungan berdasarkan metode RTS simplifikasi.", 20, 80);

            doc.save("Laporan-HVAC-RTS-v7.pdf");
        }

        // Jalankan saat startup
        window.onload = updateMaterial;
    </script>
</body>
</html>
